# 校园网自动登录脚本 (Eportal - 动态公钥型)

## 描述

这是一个 Python 脚本，用于自动登录特定类型的校园网认证系统。该系统基于 Eportal 流程，特点是需要动态获取 RSA 公钥模数，并且使用了特定的 JavaScript 实现的 RSA 加密（已在 `security.py` 中用 Python 复现）。

脚本模拟了完整的浏览器登录流程，包括：

* **网络预检**: 启动时检查互联网连通性，避免重复登录。
* **认证触发**: 访问特定 IP 地址以获取重定向。
* **参数解析**: 从重定向 URL 中提取登录页面地址、MAC 地址和查询字符串。
* **Cookie 设置**: 访问登录页面以建立会话和获取必要的 Cookies。
* **动态公钥获取**: 发送 `pageInfo` 请求以获取 RSA 公钥模数 (`publicKeyModulus`) 和指数 (`publicKeyExponent`)。
* **密码加密**: 使用 `security.py` 中提供的 RSA 实现来加密密码（结合了 MAC 地址并进行了反转）。
* **登录提交**: 发送最终的 POST 请求完成登录认证。
* **兼容性处理**: 自动处理 Gzip 压缩和 GBK/GB18030 页面编码。
* **灵活凭证输入**: 支持通过命令行参数或安全的交互式提示输入用户名和密码。

## 功能特性

* **自动登录**: 无需手动操作，一键完成认证。
* **网络预检**: 智能判断网络状态，仅在需要时执行登录。
* **动态公钥**: 适配需要额外请求获取公钥的认证机制。
* **定制加密**: 包含了针对特定 JavaScript RSA 实现的 Python 移植 (`security.py`)。
* **编码/压缩处理**: 自动处理常见的 Gzip 和 GBK/GB18030 编码问题。
* **灵活输入**: 支持命令行参数 (`-u`, `-p`) 或安全的交互式密码输入 (`getpass`)。

## 文件结构

```text
.
├── campus_login.py     # 主登录脚本
├── security.py         # RSA 加密实现 (来自 JS 移植)
└── README.md           # 本说明文件
```

## 先决条件

1. **Python 3**: 建议使用 Python 3.6 或更高版本。
2. **依赖库**:
    * `requests`: 用于发送 HTTP 请求。 (是**唯一**需要额外安装的库)

## 安装

1. **获取文件**: 确保 `campus_login.py` 和 `security.py` 文件位于同一目录下。
2. **安装 Python 依赖**: 打开终端或命令提示符，进入脚本所在目录，运行：

    ```bash
    pip install requests
    ```

## 配置

1. **`security.py`**: 此文件包含了必要的 RSA 加密实现。通常**不需要修改**此文件，除非你确认你学校的认证系统使用了不同版本的加密逻辑。
2. **脚本内常量 (可选)**: 在 `campus_login.py` 顶部，你可以根据需要调整：
    * `INITIAL_CHECK_URL`: 认证触发 IP 地址 (默认为 `http://123.123.123.123`)。
    * `INTERNET_CHECK_URL`: 用于检查网络连通性的外部网址 (默认为 `https://www.baidu.com`)。

## 使用方法

在终端或命令提示符中，导航到脚本所在的目录 (`campus_login.py` 和 `security.py` 所在的目录)，然后运行 `campus_login.py`：

1. **通过命令行参数提供用户名和密码**:

    ```bash
    python campus_login.py -u 你的用户名 -p 你的密码
    ```

    或

    ```bash
    python campus_login.py --username 你的用户名 --password 你的密码
    ```

    **安全警告**: 以此方式提供密码可能会将其记录在命令行历史中。

2. **只提供用户名，交互式输入密码**:

    ```bash
    python campus_login.py -u 你的用户名
    ```

    脚本运行时会提示输入密码（输入时不可见）。

3. **不提供参数，交互式输入用户名和密码**:

    ```bash
    python campus_login.py
    ```

    脚本会依次提示输入用户名和密码（密码输入不可见）。

脚本将首先检查网络连接。如果已连接，会提示并退出。否则，将执行登录流程并报告结果。

## 故障排除

* **登录失败 (提示密码错误等)**:
  * 确认输入的用户名和密码无误。
  * 检查 `security.py` 中的加密逻辑是否确实与你学校当前的认证系统版本完全匹配。即使看起来相似，细微差别也可能导致失败。
  * 查看脚本运行时输出的详细日志，定位失败的步骤。
* **无法提取登录 URL / 公钥**: 可能是校园网认证页面的 URL 路径、参数或 `pageInfo` 接口返回的数据结构发生了变化。需要调试脚本并更新相应的解析逻辑。
* **网络检查失败但实际已连接**: 可能是 `INTERNET_CHECK_URL` 设置的网站无法访问，尝试在脚本中更换一个更可靠的检测网址。
* **请求超时/网络错误**: 检查你的本地网络环境或目标认证服务器 (`123.123.123.123`, `172.16.128.139`) 是否正常工作。

## 免责声明与警告

* **密码安全**: 请妥善保管你的校园网密码。避免在不安全的脚本或环境中运行此脚本。命令行密码参数存在风险。
* **脚本维护**: 校园网认证系统可能随时更新，导致此脚本失效。用户可能需要自行调试和更新脚本以适应变化。
* **加密逻辑**: `security.py` 中的加密实现是根据特定 JavaScript 版本移植的，不保证适用于所有 Eportal 系统。
* **合规性**: 使用自动化脚本登录校园网可能违反你所在学校的使用规定，请自行确认并承担相应风险。

## 许可证 (可选)

本项目采用 [MIT许可证](LICENSE)。(如果需要，请创建 `LICENSE` 文件并包含 MIT 许可证文本)
